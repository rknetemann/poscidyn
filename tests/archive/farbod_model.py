# ───────────────────────── farbod_model.py ──────────────────────────
import jax.numpy as jnp
import oscidyn

# ──────────────────────────────────────────────────────────────────────────────
#  Raw coefficients copied from Supplementary Table 4 (ν = 0.16) :contentReference[oaicite:0]{index=0}:contentReference[oaicite:1]{index=1}
#  One row label + seven numbers (Eq. 1 … Eq. 7) per line.
# ──────────────────────────────────────────────────────────────────────────────
table_text = """
b111 3.65 0 0 -0.0807 0 -0.000 131 -0.0466 b112 0 11.6 0 -0.000 267 1.17 -1.17 -0.000 234 b113 0 0 15.2 -0.000 269 0 0 -0.001 12 b114 -0.242 0 -0.000 418 16.4 -0.000 231 -0.000 154 -0.635 b115 0 1.15 0.000 103 -0.000 291 12.9 -1.27 0.001 07 b116 0 -1.13 -0.000 234 -0.000 123 -1.27 31.8 0.002 11 b117 -0.144 -0.000 263 -0.001 17 -0.634 0.000 812 0.001 59 27.4 b122 11.6 -0.000 387 10.4 2.87 -0.000 952 -0.0015 0.367 b123 -0.0597 20.7 -0.303 -0.0311 -13.7 -8.35 -0.109 b124 -0.0514 5.63 -0.0362 -0.385 4.47 7.54 0.179 b125 2.29 -0.057 -14.1 4.49 -0.193 -0.0697 -18 b126 -2.32 -0.126 -8.16 8 -0.0441 -0.494 -9.19 b127 0.0561 0.791 0.0117 0.0806 -18.2 -8.97 -0.397 b133 15.2 -0.000 448 0.002 01 1.2 0.001 78 -0.003 27 8.13 b134 -0.019 0.001 78 2.29 -0.186 0.000 313 0.006 95 -0.0058 b135 -0.0147 -14 -0.121 -0.005 15 10.3 -9.72 -0.16 b136 -0.0233 -8.18 -0.14 -0.0121 -9.85 -3.8 -0.0321 b137 0.0116 0.001 07 16.5 -0.007 81 0.007 65 -0.006 99 -0.232 b144 16.4 0 0 2.26 -0.001 41 0.004 65 -19.8 b145 -0.0133 4.48 0.003 81 -0.175 3.1 -8.76 0.0714 b146 -0.0633 8.01 0.005 51 -0.26 -8.47 19.2 0.227 b147 -1.16 0.002 15 -0.005 16 -39.3 -0.000 571 0.0115 -0.279 b155 12.9 -0.003 23 5.31 1.64 -0.001 01 -0.001 47 2.64 b156 -2.53 -0.0488 -9.79 -8.34 -0.148 -0.267 -17.9 b157 0.0263 -18.2 -0.0387 0.0259 5.39 -17.6 -0.312 b166 31.8 0.0107 -1.71 9.94 0.0026 -0.0312 0.307 b167 0.061 -9.15 0.000 304 0.189 -17.8 1 -0.458 b177 27.4 0 0.0117 0.2 0.0051 -0.0057 0.11 b222 -0.000 165 21.9 0 0.000 103 -0.117 -1.95 0.000 453 b223 10.5 0.000 308 58.2 2.24 0.002 78 0.0003 8.15 b224 2.91 0 2.24 58.7 -0.003 07 0.005 54 -6.02 b225 -0.000 944 -0.34 0.002 68 -0.002 86 51 -6.71 0.007 85 b226 -0.001 46 -5.86 -0.000 207 0.004 51 -6.71 79.3 -0.000 829 b227 0.307 0.001 35 8.17 -6.03 0.007 68 -0.001 78 69.9 b233 -0.000 749 58.2 -0.0025 -0.001 13 -28.8 -2.03 -0.0032 b234 -0.0416 4.4 -0.115 -0.19 -7.88 37.6 0.0978 b235 -14.1 0.0428 -57.7 -7.9 -0.224 0.0697 -64.9 b236 -8.21 -0.0898 -4.19 37.7 0.144 -0.495 11.6 b237 -0.008 33 16.4 -0.0144 0.0216 -64.9 11.6 -0.316 b244 0 58.7 0.003 45 0.002 42 34.5 21.1 0.001 02 b245 4.56 -0.0935 -7.91 68.8 -0.267 -0.195 -26.9 b246 8.12 -0.169 37.7 42 -0.116 -0.904 -58.8 b247 0.0902 -12 0.0513 0.398 -26.9 -58.7 -0.63 b255 -0.003 67 51 -0.008 05 -0.006 74 -20.2 10.4 -0.0024 b256 -0.000 602 -13.5 0.0222 -0.0165 20.7 46 0.0198 b257 -18.3 0.0616 -65 -26.9 0.146 0.128 -15.4 b266 0.0114 79.4 0.009 16 0.0192 23.2 4.87 -0.0265 b267 -9.2 0.121 11.6 -59.1 0.0295 0.535 72.6 b277 0.001 43 70 -0.006 57 -0.02 -7.5 36.4 -0.0217 b333 0.000 617 -0.0005 58.5 -0.002 02 0.003 16 0.000 402 0.004 16 b334 1.21 0 -0.006 48 67 -0.003 99 0.003 73 4.26 b335 0.001 61 -28.9 0.009 64 -0.004 11 96.5 3.74 0.011 b336 -0.0036 -2.01 -0.000 215 0.002 01 3.72 145 -0.004 39 b337 8.21 -0.002 74 0.0113 4.26 0.0106 -0.004 83 156 b344 0 0.002 94 67 0.001 08 0.005 33 -0.000 892 -0.007 72 b345 0.009 29 -7.9 -0.0623 -0.089 10.9 -16.8 -0.0892 b346 -0.0278 37.8 -0.0846 -0.116 -16.8 2 0.0116 b347 0.006 47 0.0126 8.55 0.122 0.001 04 -0.0017 -0.208 b355 5.3 -0.008 47 96.5 5.51 0.028 -0.0255 71.2 b356 -9.82 0.0311 7.38 -16.9 -0.134 -0.235 -19.5 b357 -0.0299 -65.1 0.005 07 0.006 18 143 -19.5 -0.193 b366 -1.73 0.0104 145 1.16 -0.0114 -0.097 -12.7 b367 -0.0406 11.6 0.0688 -0.0194 -19.6 -25.1 -0.472 b377 0.0107 -0.007 93 156 0.0176 0.008 23 -0.0476 0.137 b444 0.767 0.000 402 0.000 369 81.4 -0.003 72 0.0116 -7.64 b445 -0.001 48 34.5 0.005 03 -0.0106 112 41 0.0106 b446 0.002 54 21.2 -0.003 15 0.0327 40.9 192 -0.0431 b447 -20.1 0.003 05 -0.007 74 -22.9 0.0118 -0.0465 253 b455 1.66 -0.008 14 5.52 112 -0.008 63 -0.0149 -9.73 b456 -8.43 -0.114 -16.9 81.7 -0.224 -0.459 -80.8 b457 0.0719 -26.9 -0.004 88 0.178 -19.3 -80.8 -0.367 b466 9.98 0.0206 1.16 192 0.0156 0.393 -103 b467 0.195 -59.1 -0.002 07 0.455 -80.9 -205 -0.59 b477 0.215 -0.0217 0.0231 252 -0.043 0.003 34 0.049 b555 -0.000 449 -6.75 0.009 86 -0.002 93 76.1 -9.91 0.0205 b556 0.001 39 10.4 -0.0263 -0.0158 -29.7 158 -0.0479 b557 2.57 -0.003 12 71.3 -9.74 0.0581 -0.0474 240 b566 0.005 79 23.2 -0.0138 0.0161 158 -0.405 -0.0349 b567 -17.9 0.118 -19.6 -81.1 -0.0376 0.243 -0.642 b577 0.004 84 -7.5 0.006 27 -0.0436 240 -0.186 -0.007 17 b666 -0.0145 1.63 -0.0311 0.139 -0.136 357 -0.105 b667 0.147 -0.0237 -12.7 -103 -0.0374 -0.317 406 b677 -0.005 76 36.6 -0.0549 0.001 93 -0.251 406 0.145 b777 -0.0396 -0.006 22 0.0474 0.0102 -0.001 17 0.0459 295
"""

# ──────────────────────────────────────────────────────────────────────────────
#  Convert the text table into γ[i,j,k,l]
# ──────────────────────────────────────────────────────────────────────────────
N = 7                                   # number of modes / equations
gamma = jnp.zeros((N, N, N, N))         # γ_i j k l  (4-D tensor)

# Preprocess the table_text by adding linebreaks before each 'b'
processed_text = table_text.strip()
processed_text = processed_text.replace(' b', '\nb')

for line in processed_text.splitlines():
    parts = line.split()
    if not parts or not parts[0].startswith('b'):  # Skip empty lines or invalid lines
        continue
    
    label, values = parts[0], parts[1:]

    # decode row label, e.g. 'b112' → j=0, k=0, l=1
    j, k, l = (int(label[1]) - 1,
               int(label[2]) - 1,
               int(label[3]) - 1)

    # insert every column into the leading index i (Eq. 1 … Eq. 7)
    for i, val in enumerate(values):
        gamma = gamma.at[i, j, k, l].set(float(val))


N = 7
m = jnp.array([0.204, 0.195, 0.183, 0.103, 0.192, 0.118, 0.0698])
c = jnp.array([1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0])
k = jnp.array([[4.93, 0, 0, 0, 0, 0, 0],
                [0, 10.6, 0, 0, 0, 0, 0],
                [0, 0, 19.7, 0, 0, 0, 0],
                [0, 0, 0, 20.3, 0, 0, 0],
                [0, 0, 0, 0, 19.8, 0, 0],
                [0, 0, 0, 0, 0, 38.2, 0],
                [0, 0, 0, 0, 0, 0, 44.2]])
alpha = jnp.zeros((N, N, N))
F_amp = jnp.array([1.53, 0.002, 0.004, 0.0025, 0.0035, 0.003, 0.0045])
F_omega = jnp.array([1.0])

mdl_farbod = oscidyn.PhysicalModel(
    N=N,
    m=m,
    c=oscidyn.Damping.MODERATELY_DAMPED,
    k_1=k,
    k_2=alpha,
    k_3=gamma,
    F_amp=F_amp,
    F_omega=F_omega
).non_dimensionalise()